<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Hızlı Okuma ve Alıştırmalar</title>
<style>
body {
  font-family: Arial, sans-serif;
  background: #f5f5f5;
  display: flex;
  height: 100vh;
  margin: 0;
}

/* Ana içerik */
#mainContent {
  display: none;
  flex: 1;
}

.left {
  flex: 1;
  display: flex;
  justify-content: center;
  align-items: center;
  background: #fff;
  border-right: 2px solid #ddd;
  padding: 20px;
}
.left img {
  max-width: 100%;
  max-height: 80%;
  object-fit: contain;
}

.right {
  flex: 1;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  gap: 15px;
  padding: 20px;
  overflow-y: auto;
}

/* API PANEL */
#apiPanel{
  width:80%;
  background:#eef3ff;
  border:1px solid #c9d7ff;
  border-radius:8px;
  padding:12px;
  margin-bottom:10px;
}

#apiStatus{
  font-size:13px;
  margin-bottom:6px;
}

#apiPanel input{
  width:100%;
  padding:6px;
  margin-bottom:6px;
}

#apiPanel button{
  width:100%;
  padding:6px;
  background:#007bff;
  border:none;
  color:white;
  border-radius:4px;
  cursor:pointer;
}

/* Kart */
.card {
  width: 80%;
  background: white;
  padding: 20px;
  text-align: center;
  border-radius: 12px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.1);
  cursor: pointer;
}
.card:hover {
  transform: translateY(-4px);
}
.card h2 {
  font-size: 18px;
  margin: 0;
  color: #333;
}

/* Kullanıcı kodu */
#codeOverlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.5);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:9999;
}
#codeBox{
  background:#ffffff;
  padding:20px;
  border-radius:8px;
  max-width:320px;
  width:90%;
}
#codeBox input{
  width:100%;
  padding:8px;
  margin-bottom:8px;
}
#codeBox button{
  width:100%;
  padding:8px;
  background:#007bff;
  border:none;
  color:white;
}
#codeError{font-size:12px;color:red;}
</style>
</head>
<body>

<!-- KULLANICI KOD -->
<div id="codeOverlay">
<div id="codeBox">
<h2>Kullanıcı Kodu</h2>
<input id="userCodeInput" placeholder="Kod">
<button onclick="checkUserCode()">Giriş Yap</button>
<div id="codeError"></div>
</div>
</div>

<!-- ANA EKRAN -->
<div id="mainContent">

<!-- SOL -->
<div class="left">
<img src="Logo.jpg">
</div>

<!-- SAĞ -->
<div class="right">

<!-- API PANEL -->
<div id="apiPanel">
  <div id="apiStatus">API durumu kontrol ediliyor...</div>
  <input id="apiInput" placeholder="OpenAI API Key" type="password">
  <button onclick="checkAPI()">API Doğrula</button>
</div>

<div class="card" onclick="openIfAPI('goz.html')"><h2>Göz Egzersizi</h2></div>
<div class="card" onclick="openIfAPI('kelime.html')"><h2>Kelime Çalışması</h2></div>
<div class="card" onclick="openIfAPI('blok.html')"><h2>Blok Metin</h2></div>
<div class="card" onclick="openIfAPI('hafiza.html')"><h2>Hafıza Oyunu</h2></div>

</div>
</div>

<script>
/* ==== AYAR ==== */
const CODE_LIST_URL = "https://ilhantopaloglu.github.io/HizliOkuma/kod.txt";
const API_CHECK_URL = "http://localhost:3000/api-check";

const USER_CODE_KEY = "USER_CODE";
const API_KEY      = "OPENAI_KEY";

const codeOverlay = document.getElementById("codeOverlay");
const codeError   = document.getElementById("codeError");
const apiStatus   = document.getElementById("apiStatus");
const apiInput    = document.getElementById("apiInput");
const mainContent = document.getElementById("mainContent");

/* ==== AÇILIŞ ==== */
document.addEventListener("DOMContentLoaded", ()=>{
  const code = localStorage.getItem(USER_CODE_KEY);
  if(code) checkUserCode(code);
  else codeOverlay.style.display="flex";

  const savedAPI = localStorage.getItem(API_KEY);
  if(savedAPI){
    apiInput.value = savedAPI;
    checkAPI(true);
  }
});

/* ==== KOD KONTROL ==== */
async function checkUserCode(preset){
  const entered = preset || userCodeInput.value.trim();
  let txt;

  try{
    const r = await fetch(CODE_LIST_URL+"?t="+Date.now());
    txt = await r.text();
  }catch{
    codeError.textContent="Kod listesi okunamadı.";
    return;
  }

  const now = new Date(); now.setHours(0,0,0,0);
  let ok=false;

  txt.split(/\r?\n/).forEach(line=>{
    const p=line.split(/\s+/);
    if(p.length<3)return;
    if(p[0].toUpperCase()!=entered.toUpperCase())return;
    const s=parseDate(p[1]), e=parseDate(p[2]);
    if(s && e && s<=now && now<=e) ok=true;
  });

  if(!ok){
    localStorage.removeItem(USER_CODE_KEY);
    codeOverlay.style.display="flex";
    codeError.textContent="Kod geçersiz.";
    return;
  }

  localStorage.setItem(USER_CODE_KEY, entered);
  codeOverlay.style.display="none";
  mainContent.style.display="flex";
}

/* ==== TARİH ==== */
function parseDate(t){
  const m=t.match(/(\d{2})\.(\d{2})\.(\d{4})/);
  if(!m)return null;
  return new Date(m[3],m[2]-1,m[1]);
}

/* ==== API DOĞRULA ==== */
async function checkAPI(silent=false){
  const key=apiInput.value.trim();
  if(!key){ if(!silent) setStatus("API girilmedi","red"); return;}

  setStatus("API kontrol ediliyor...","blue");

  try{
    const r=await fetch(API_CHECK_URL,{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({apiKey:key})
    });
    const d=await r.json();

    if(d.ok){
      localStorage.setItem(API_KEY,key);
      setStatus("✅ API Kayıtlı","green");
    }else{
      localStorage.removeItem(API_KEY);
      setStatus("❌ API Hatalı","red");
    }
  }catch{
    setStatus("⚠ Backend bağlantı yok","orange");
  }
}

function setStatus(txt,color){
  apiStatus.textContent=txt;
  apiStatus.style.color=color;
}

/* ==== KONTROL ==== */
function openIfAPI(page){
  if(!localStorage.getItem(API_KEY)){
    alert("API doğrulanmadan devam edemezsin");
    return;
  }
  window.location.href=page;
}

</script>
</body>
</html>
